\documentclass[11pt]{article}
\usepackage[utf8]{inputenc}
\usepackage[spanish]{babel}
\usepackage{geometry}
\usepackage{booktabs}
\usepackage{longtable}
\usepackage{array}
\usepackage{xcolor}
\usepackage{hyperref}

\geometry{a4paper, landscape, margin=1.5cm}

\title{Documentación de Endpoints de la API}
\author{IS-K Pop Backend}
\date{6 de diciembre de 2025}

\begin{document}

\maketitle

\section*{Información General}

\textbf{Base URL:} \texttt{http://localhost:\{PORT\}/api}

\section{Autenticación (\texttt{/auth})}

\begin{longtable}{lllll}
\toprule
\textbf{Método} & \textbf{URL} & \textbf{Autenticación} & \textbf{Rol Requerido} & \textbf{Descripción} \\
\midrule
\endhead
POST & \texttt{/api/auth/login} & No & - & Iniciar sesión \\
\bottomrule
\end{longtable}

\section{Usuarios (\texttt{/user})}

\begin{longtable}{lllll}
\toprule
\textbf{Método} & \textbf{URL} & \textbf{Autenticación} & \textbf{Rol Requerido} & \textbf{Descripción} \\
\midrule
\endhead
POST & \texttt{/api/user} & No & - & Crear usuario \\
GET & \texttt{/api/user} & No & Admin & Listar todos los usuarios \\
GET & \texttt{/api/user/:id} & No & Admin & Obtener usuario por ID \\
PUT & \texttt{/api/user/:id} & No & Owner/Admin & Actualizar usuario (requiere ser dueño o admin) \\
DELETE & \texttt{/api/user/:id} & No & Admin & Eliminar usuario \\
\bottomrule
\end{longtable}

\section{Agencias (\texttt{/agency})}

\begin{longtable}{lllll}
\toprule
\textbf{Método} & \textbf{URL} & \textbf{Autenticación} & \textbf{Rol Requerido} & \textbf{Descripción} \\
\midrule
\endhead
POST & \texttt{/api/agency} & Sí & Staff & Crear agencia \\
GET & \texttt{/api/agency} & Sí & - & Listar todas las agencias \\
GET & \texttt{/api/agency/:id} & Sí & - & Obtener agencia por ID \\
PUT & \texttt{/api/agency/:id} & Sí & Staff & Actualizar agencia \\
DELETE & \texttt{/api/agency/:id} & Sí & Staff & Eliminar agencia \\
GET & \texttt{/api/agency/search/agency\_name} & Sí & - & Buscar agencias por nombre \\
GET & \texttt{/api/agency/search/agency\_address} & Sí & - & Buscar agencias por dirección \\
GET & \texttt{/api/agency/search/agency\_foundation} & Sí & - & Buscar por fecha fundación \\
\bottomrule
\end{longtable}

\section{Aprendices (\texttt{/apprentice})}

\begin{longtable}{lllll}
\toprule
\textbf{Método} & \textbf{URL} & \textbf{Autenticación} & \textbf{Rol Requerido} & \textbf{Descripción} \\
\midrule
\endhead
POST & \texttt{/api/apprentice/:id} & Sí & Staff & Crear aprendiz (id = agencyId) \\
GET & \texttt{/api/apprentice} & Sí & - & Listar todos los aprendices \\
GET & \texttt{/api/apprentice/:id} & Sí & - & Obtener aprendiz por ID \\
GET & \texttt{/api/apprentice/name/:name} & Sí & - & Obtener aprendiz por nombre \\
GET & \texttt{/api/apprentice/agency/:id} & Sí & - & Listar aprendices por agencia \\
PUT & \texttt{/api/apprentice/:id} & Sí & Staff & Actualizar aprendiz \\
DELETE & \texttt{/api/apprentice/:id} & Sí & Staff & Eliminar aprendiz \\
\bottomrule
\end{longtable}

\section{Artistas (\texttt{/artist})}

\begin{longtable}{lllll}
\toprule
\textbf{Método} & \textbf{URL} & \textbf{Autenticación} & \textbf{Rol Requerido} & \textbf{Descripción} \\
\midrule
\endhead
POST & \texttt{/api/artist} & Sí & Staff & Crear artista \\
GET & \texttt{/api/artist} & Sí & - & Listar todos los artistas \\
GET & \texttt{/api/artist/:apprenticeId\&:groupId} & Sí & - & Obtener artista específico por IDs compuestos \\
GET & \texttt{/api/artist/:id} & Sí & Agency Access & Obtener artistas por agencia (id = agencyId) \\
PUT & \texttt{/api/artist/:apprenticeId\&:groupId} & Sí & Staff & Actualizar artista \\
DELETE & \texttt{/api/artist/:apprenticeId\&:groupId} & Sí & Staff & Eliminar artista \\
\bottomrule
\end{longtable}

\section{Aplicaciones (\texttt{/application})}

\begin{longtable}{lllll}
\toprule
\textbf{Método} & \textbf{URL} & \textbf{Autenticación} & \textbf{Rol Requerido} & \textbf{Descripción} \\
\midrule
\endhead
POST & \texttt{/api/application/:id} & Sí & Staff & Crear aplicación (id = applicationId) \\
GET & \texttt{/api/application} & Sí & - & Listar todas las aplicaciones \\
GET & \texttt{/api/application/:id} & Sí & - & Obtener aplicación por ID \\
PUT & \texttt{/api/application/:id} & Sí & Staff & Actualizar aplicación \\
DELETE & \texttt{/api/application/:id} & Sí & Staff & Eliminar aplicación \\
\bottomrule
\end{longtable}

\section{Conceptos (\texttt{/concept})}

\begin{longtable}{lllll}
\toprule
\textbf{Método} & \textbf{URL} & \textbf{Autenticación} & \textbf{Rol Requerido} & \textbf{Descripción} \\
\midrule
\endhead
POST & \texttt{/api/concept} & No & - & Crear concepto \\
GET & \texttt{/api/concept} & No & - & Listar todos los conceptos \\
GET & \texttt{/api/concept/:id} & No & - & Obtener concepto por ID \\
PUT & \texttt{/api/concept/:id} & No & - & Actualizar concepto \\
DELETE & \texttt{/api/concept/:id} & No & - & Eliminar concepto \\
\bottomrule
\end{longtable}

\section{Grupos (\texttt{/group})}

\begin{longtable}{lllll}
\toprule
\textbf{Método} & \textbf{URL} & \textbf{Autenticación} & \textbf{Rol Requerido} & \textbf{Descripción} \\
\midrule
\endhead
POST & \texttt{/api/group} & No & - & Crear grupo \\
GET & \texttt{/api/group} & No & - & Listar todos los grupos \\
GET & \texttt{/api/group/:id} & No & - & Obtener grupo por ID \\
PUT & \texttt{/api/group/update/:id} & No & - & Actualizar grupo \\
DELETE & \texttt{/api/group/delete/:id} & No & - & Eliminar grupo \\
GET & \texttt{/api/group/search/name} & No & - & Buscar grupo por nombre \\
GET & \texttt{/api/group/search/debut} & No & - & Buscar grupos por fecha debut \\
GET & \texttt{/api/group/search/status} & No & - & Buscar grupos por estado \\
GET & \texttt{/api/group/search/membercount} & No & - & Buscar grupos por cantidad miembros \\
GET & \texttt{/api/group/search/member} & No & - & Buscar grupos por miembro \\
GET & \texttt{/api/group/search/agency} & No & - & Buscar grupos por agencia \\
GET & \texttt{/api/group/search/concept} & No & - & Buscar grupos por concepto \\
GET & \texttt{/api/group/search/visualconcept} & No & - & Buscar grupos por concepto visual \\
POST & \texttt{/api/group/:id/members/add} & No & - & Agregar miembros al grupo \\
POST & \texttt{/api/group/:id/members/remove} & No & - & Remover miembros del grupo \\
POST & \texttt{/api/group/:id/albums/add} & No & - & Agregar álbumes al grupo \\
POST & \texttt{/api/group/:id/activities/add} & No & - & Agregar actividades al grupo \\
\bottomrule
\end{longtable}

\section{Actividades (\texttt{/activity})}

\begin{longtable}{lllll}
\toprule
\textbf{Método} & \textbf{URL} & \textbf{Autenticación} & \textbf{Rol Requerido} & \textbf{Descripción} \\
\midrule
\endhead
POST & \texttt{/api/activity} & Sí & Staff & Crear actividad \\
GET & \texttt{/api/activity} & Sí & - & Listar todas las actividades \\
GET & \texttt{/api/activity/:id} & Sí & - & Obtener actividad por ID \\
GET & \texttt{/api/activity/:apprenticeId\&:groupId} & Sí & - & Obtener actividades por artista \\
PUT & \texttt{/api/activity/:id} & Sí & Staff & Actualizar actividad \\
DELETE & \texttt{/api/activity/:id} & Sí & Staff & Eliminar actividad \\
POST & \texttt{/api/activity/addArtist} & Sí & Staff & Agregar artista a actividad \\
\bottomrule
\end{longtable}

\section{Contratos (\texttt{/contract})}

\begin{longtable}{lllll}
\toprule
\textbf{Método} & \textbf{URL} & \textbf{Autenticación} & \textbf{Rol Requerido} & \textbf{Descripción} \\
\midrule
\endhead
POST & \texttt{/api/contract} & No & - & Crear contrato \\
GET & \texttt{/api/contract} & No & - & Listar todos los contratos \\
GET & \texttt{/api/contract/find} & No & - & Obtener contrato por ID (query param) \\
PUT & \texttt{/api/contract} & No & - & Actualizar contrato \\
DELETE & \texttt{/api/contract} & No & - & Eliminar contrato \\
\bottomrule
\end{longtable}

\section{Premios (\texttt{/award})}

\begin{longtable}{lllll}
\toprule
\textbf{Método} & \textbf{URL} & \textbf{Autenticación} & \textbf{Rol Requerido} & \textbf{Descripción} \\
\midrule
\endhead
POST & \texttt{/api/award} & No & - & Crear premio \\
GET & \texttt{/api/award} & No & - & Listar todos los premios \\
GET & \texttt{/api/award/:id} & No & - & Obtener premio por ID \\
PUT & \texttt{/api/award/:id} & No & - & Actualizar premio \\
DELETE & \texttt{/api/award/:id} & No & - & Eliminar premio \\
\bottomrule
\end{longtable}

\section{Listas de Popularidad (\texttt{/populist})}

\begin{longtable}{lllll}
\toprule
\textbf{Método} & \textbf{URL} & \textbf{Autenticación} & \textbf{Rol Requerido} & \textbf{Descripción} \\
\midrule
\endhead
POST & \texttt{/api/populist} & No & - & Crear lista de popularidad \\
GET & \texttt{/api/populist} & No & - & Listar todas las listas \\
GET & \texttt{/api/populist/:id} & No & - & Obtener lista por ID \\
PUT & \texttt{/api/populist/:id} & No & - & Actualizar lista \\
DELETE & \texttt{/api/populist/:id} & No & - & Eliminar lista \\
POST & \texttt{/api/populist/addSong} & No & - & Agregar canción a lista \\
\bottomrule
\end{longtable}

\section{Conceptos Visuales (\texttt{/visual-concept})}

\begin{longtable}{lllll}
\toprule
\textbf{Método} & \textbf{URL} & \textbf{Autenticación} & \textbf{Rol Requerido} & \textbf{Descripción} \\
\midrule
\endhead
POST & \texttt{/api/visual-concept} & No & - & Crear concepto visual \\
GET & \texttt{/api/visual-concept} & No & - & Listar todos los conceptos visuales \\
GET & \texttt{/api/visual-concept/:id} & No & - & Obtener concepto visual por ID \\
PUT & \texttt{/api/visual-concept/:id} & No & - & Actualizar concepto visual \\
DELETE & \texttt{/api/visual-concept/:id} & No & - & Eliminar concepto visual \\
\bottomrule
\end{longtable}

\section{Notas Importantes}

\subsection*{Autenticación}
Los endpoints que requieren autenticación necesitan un token JWT en el header:

\texttt{Authorization: Bearer \{token\}}

\subsection*{Roles Disponibles}
\begin{itemize}
    \item \textbf{Admin}: Acceso completo al sistema - puede gestionar todos los usuarios
    \item \textbf{Staff}: Director/Manager - puede gestionar agencias, aprendices, artistas y actividades
    \item \textbf{Agency Access}: Rol especial para acceder a recursos de agencias específicas (requireAgencyAccess middleware)
    \item \textbf{Artist}: Artista del sistema
    \item \textbf{Apprentice}: Aprendiz del sistema
    \item \textbf{Manager}: Manager de una agencia
    \item \textbf{Director}: Director de una agencia
\end{itemize}

\subsection*{Middlewares de Autenticación}
\begin{itemize}
    \item \textbf{AuthMiddleware.authenticate()}: Verifica token JWT válido
    \item \textbf{RoleMiddleware.onlyAdmin()}: Solo permite acceso a usuarios Admin
    \item \textbf{RoleMiddleware.onlyStaff()}: Permite acceso a Director y Manager
    \item \textbf{RoleMiddleware.requireAgencyAccess}: Verifica acceso a recursos de la agencia
    \item \textbf{RoleMiddleware.updatePropertiesId()}: Permite actualizar si eres dueño del recurso o Admin
\end{itemize}

\subsection*{Advertencia}
\textcolor{red}{\textbf{CORREGIDO:}} El conflicto en \texttt{index.ts} línea 23 ha sido resuelto. Las rutas de \texttt{/concept} ahora usan correctamente \texttt{conceptRoutes.getRouter()}.

\subsection*{Notas de Implementación}
\begin{itemize}
    \item \textbf{IMPORTANTE - UserRoutes:} La autenticación está comentada (\texttt{//this.router.use(AuthMiddleware.authenticate())}), por lo que actualmente NO se requiere autenticación para los endpoints de usuario. Esto debe ser habilitado en producción.
    \item Algunos endpoints no requieren autenticación: concept, group, contract, award, populist, visual-concept
    \item Se recomienda agregar autenticación y roles a estos endpoints en producción
    \item Los endpoints de grupos tienen rutas especiales: \texttt{PUT /update/:id} y \texttt{DELETE /delete/:id}
    \item El endpoint de artistas usa IDs compuestos: \texttt{:apprenticeId\&:groupId} (clave primaria compuesta)
    \item Los endpoints de contratos no usan parámetros en la ruta para PUT/DELETE, se envía el id en el body
    \item El endpoint \texttt{GET /api/contract/find} espera el id como query parameter
    \item El endpoint \texttt{POST /api/apprentice/:id} recibe el agencyId en la ruta
    \item El endpoint \texttt{POST /api/application/:id} recibe el applicationId en la ruta
    \item RoleMiddleware.updatePropertiesId() permite actualizar usuario si eres el dueño del perfil o admin
\end{itemize}

\subsection*{Configuración}
El puerto debe ser configurado en el archivo \texttt{secrets.ts}.

\end{document}
