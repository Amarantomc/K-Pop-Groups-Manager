// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

// Looking for ways to speed up your queries, or scale easily with your serverless or edge functions?
// Try Prisma Accelerate: https://pris.ly/cli/accelerate-init

generator client {
  provider = "prisma-client-js"
  output   = "../src/generated/prisma"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User{
  id Int @id @default(autoincrement())
  name String
  email String @unique
  password String  
  role String

  perfilManager PerfilManager?
  perfilDirector PerfilDirector?
  perfilAprendiz PerfilAprendiz?
  perfilArtista PerfilArtista?
}

model PerfilManager {
  userId Int @id
  agenciaId Int
 usuario User @relation(fields: [userId], references: [id], onDelete: Cascade)
  agencia Agencia @relation( fields: [agenciaId], references: [id])
}

model PerfilDirector {
  userId Int @id
  agenciaId Int

 usuario User @relation(fields: [userId], references: [id], onDelete: Cascade)
  agencia Agencia @relation( fields: [agenciaId], references: [id])
}

model PerfilAprendiz {
  userId Int @id
  aprendizId Int @unique
 
 usuario User @relation(fields: [userId], references: [id], onDelete: Cascade)
  aprendiz Aprendiz @relation(fields: [aprendizId], references: [id])
}

model PerfilArtista {
  userId Int @id
  IdAp Int
  IdGr Int
  
  usuario User @relation(fields: [userId], references: [id], onDelete: Cascade)
  artista Artista @relation(fields: [IdAp, IdGr], references: [idAp, idGr])
  
  @@unique([IdAp, IdGr])
}

model Agencia{
  id Int @id @default(autoincrement())
  nombre String
  ubicacion String
  fechaFundacion DateTime 
  Contrato Contrato []
  Aprendices AprendizEnAgencia[]
  Evaluaciones EvaluacionAprendiz[]
  SolicitudesAprendiz AprendizSolicitaGrupo[]
  SolicitudesArtistas ArtistaSolicitaGrupo[]
  Grupos Grupo[]
  Managers PerfilManager []
  Directores PerfilDirector [] 
  ContratosGrupo ContratoGrupo []
}
model Aprendiz{
  id Int @id @default(autoincrement())
  idSolicitud  Int ?
  nombreCompleto  String
  fechaNacimiento DateTime @default(now())
  edad Int
  nivelEntrenamiento Int
  estadoAprendiz String
  Agencia AprendizEnAgencia[]
  Evaluacion EvaluacionAprendiz[]
  Artista Artista ?
  SolicitudGrupo AprendizSolicitaGrupo[]
  Perfil PerfilAprendiz?
  AprendizEnSolicitud Solicitud ? @relation(fields: [idSolicitud], references: [id])
}
model Actividad{
  id Int @id @default(autoincrement())
  responsable String
  lugar String
  fecha DateTime @default(now())
  tipoActividad String
  //Nuevo
  tipoEvento String
  Personas PersonasEnActividad[]
  
  Ingreso Ingreso[]
}

model Ingreso{
  idIng Int @default(autoincrement())
  idAct Int
  monto Decimal
  fecha DateTime @default(now())
  descripcion String
  actividad Actividad @relation(fields: [idAct], references: [id],onDelete: Cascade)
  
  @@id([idIng,idAct])
}

model Concepto{
  id Int @id @default(autoincrement())
  nombre String
  descripcion String
  Grupo Grupo[]
  
}

model ConceptoVisual{
  id Int @id @default(autoincrement())
  //Buscar como tener img
  imagen String
  Grupo Grupo []
  
  
}

model Grupo{
  id Int @id @default(autoincrement())
  nombreCompleto String
  fechaDebut DateTime
  estadoGrupo String
  idConcepto Int
  idConceptoVisual Int
  Nomiembros Int
  concepto Concepto @relation(fields: [idConcepto], references: [id])
  conceptoVisual ConceptoVisual @relation(fields: [idConceptoVisual], references: [id])

  Actividades PersonasEnActividad[]
  Album Album[]
  Artista Artista[]
  HistorialArtistas ArtistaEnGrupo[]
  Lanzamiento GrupoLanzaAlbum[]
  Agencias Agencia[]
  Contratos ContratoGrupo []

}

model Album{
  id Int @id @default(autoincrement())
  idGrupo Int
  titulo String
  fechaLanzamiento DateTime @default(now())
  productor String
  NoCanciones Int
  NoCopiasVendidas Int
  Canciones Cancion[]
  grupo Grupo @relation(fields: [idGrupo], references: [id])
  Premios AlbumPremiado[]
  LanzamientoArtista ArtistaLanzaAlbum[]
  LanzamientoGrupo GrupoLanzaAlbum[]
  
}
model Artista {
  idAp Int @unique
  idGr Int
  idSolicitud  Int ?
  nombreArtistico String
  fechaDebut DateTime
  estadoArtista String
  grupo Grupo @relation(fields: [idGr], references: [id])
  aprendiz  Aprendiz @relation(fields: [idAp],references: [id])
  Contrato Contrato []
  HistorialGrupos ArtistaEnGrupo []
  Actividades PersonasEnActividad[]
  Lanzamientos ArtistaLanzaAlbum[]
  SolicitudGrupo ArtistaSolicitaGrupo[]
  Perfil PerfilArtista?
  ArtistaEnSolicutud Solicitud ?@relation(fields: [idSolicitud],references: [id])
  

  

  @@id([idAp,idGr])
}
model Solicitud{
  id Int @id @default(autoincrement())
  nombreGrupo String
  idConcepto Int
  roles String []
  idAgencia Int
  fechaSolicitud DateTime @default(now())
  //Referencia
  AprendizMiembro Aprendiz []
  ArtistaMiembro Artista []
  SolicitudGrupoAprendiz AprendizSolicitaGrupo[]
  SolicitudGrupoArtista ArtistaSolicitaGrupo[]
    estado String
}
model ListaPopularidad{
  id Int @id @default(autoincrement())
  nombre String
  tipoLista String
  Canciones CancionEnListaDePopularidad[]
}
model Cancion{
  id Int @id @default(autoincrement())
  titulo String
  genero String
  productor String
  fechaLanzamiento DateTime
  ListaDePopularidad CancionEnListaDePopularidad[]
  Albums Album[]
}
model Premio{
  id Int @id @default(autoincrement())
  tituloPremio String
  nombreAcademia String
  Albums  AlbumPremiado[]
}

model Contrato {
  idAg                 Int
  idAp                 Int
  idGr                  Int
  fechaInicio           DateTime
  fechaFinalizacion     DateTime?
  estado                String
  condicionesIniciales  String
  distribucionIngresos  String

  Artista Artista @relation(fields: [idAp, idGr], references: [idAp, idGr],onDelete: Cascade)
  Agencia Agencia @relation(fields: [idAg], references: [id],onDelete: Cascade)

  @@id([idAg, idAp, idGr, fechaInicio])
  @@map("Contrato")
}

model ContratoGrupo{
  id Int @id @default(autoincrement())
  idAg Int 
  IdGr Int 
  fechaInicio DateTime
  fechaFinalizacion DateTime ?
  estado String
  condicionesIniciales String
  distribucionIngresos String
  Agencia Agencia  @relation(fields: [idAg], references: [id],onDelete: Cascade)
  Grupo  Grupo  @relation(fields: [IdGr], references: [id], onDelete: Cascade)
  
 @@map("ContratoGrupo")

}


model ArtistaEnGrupo {
  idAp              Int
  idGrupoDebut      Int
  idGr               Int
  fechaInicio       DateTime
  fechaFinalizacion DateTime?
  rol               String

  artista Artista @relation(fields: [idAp, idGrupoDebut], references: [idAp, idGr])
  grupo   Grupo   @relation(fields: [idGr], references: [id])

  @@id([idAp, idGrupoDebut, idGr, fechaInicio])
  @@map("ArtistaEnGrupo")
}

model AlbumPremiado {
  idAlb    Int
  idPremio Int
  año      Int

  album  Album  @relation(fields: [idAlb], references: [id])
  premio Premio @relation(fields: [idPremio], references: [id])

  @@id([idAlb, idPremio])
  @@map("AlbúmPremiado")
}

model CancionEnListaDePopularidad {
  idCa      Int
  idLista   Int
  posicion  Int
  año       Int

  cancion Cancion @relation(fields: [idCa], references: [id])
  listaPopularidad ListaPopularidad @relation(fields: [idLista], references: [id])

  @@id([idCa, idLista])
  @@map("CanciónEnListaDePopularidad")
}

model AprendizEnAgencia {
  idAp              Int
  idAg              Int
  fechaInicio       DateTime
  fechaFinalizacion DateTime?

  aprendiz Aprendiz @relation(fields: [idAp], references: [id],onDelete: Cascade)
  agencia  Agencia  @relation(fields: [idAg], references: [id],onDelete: Cascade)

  @@id([idAp, idAg, fechaInicio])
  @@map("AprendizEnAgencia")
}

model EvaluacionAprendiz {
  idAp            Int
  idAg            Int
  fechaEvaluacion DateTime
  evaluacion      Int

  aprendiz Aprendiz @relation(fields: [idAp], references: [id],onDelete: Cascade)
  agencia  Agencia  @relation(fields: [idAg], references: [id],onDelete: Cascade)

  @@id([idAp, idAg, fechaEvaluacion])
  @@map("EvaluaciónAprendiz")
}

model PersonasEnActividad {
  //Cambiar nombre
  id Int @id @default(autoincrement())
  idAp     Int ?
  idGr     Int ?
  idAct    Int
  //Nuevo
  idGrupos Int ?
  aceptado Boolean

  artista   Artista ?   @relation(fields: [idAp, idGr], references: [idAp, idGr])
  actividad Actividad  @relation(fields: [idAct], references: [id])
  grupos Grupo ? @relation(fields: [idGrupos], references: [id])

  
  @@map("PersonasEnActividad")
}

 

model ArtistaLanzaAlbum {
  idAp             Int
  idGr             Int
  idAlb            Int
  

  artista Artista @relation(fields: [idAp, idGr], references: [idAp, idGr])
  album Album @relation(fields: [idAlb], references: [id])
 

  @@id([idAp, idGr, idAlb])
  @@map("ArtistaLanzaÁlbum")
}

model GrupoLanzaAlbum {
  idGr              Int
  idAlb            Int
  

  grupo Grupo @relation(fields: [idGr], references: [id])
  album Album @relation(fields: [idAlb], references: [id])
 

  @@id([idGr, idAlb])
  @@map("GrupoLanzaÁlbum")
}



model AprendizSolicitaGrupo {
  idAp        Int
  idAg        Int
  idSolicitud Int
  estado    String

  aprendiz  Aprendiz  @relation(fields: [idAp], references: [id])
  agencia   Agencia   @relation(fields: [idAg], references: [id])
  solicitud Solicitud @relation(fields: [idSolicitud], references: [id])

  @@id([idAp, idAg, idSolicitud])
  @@map("AprendizSolicitaGrupo")
}

model ArtistaSolicitaGrupo {
  idAp        Int
  idGr         Int
  idAg        Int
  idSolicitud Int
  estado    String

  artista   Artista   @relation(fields: [idAp, idGr], references: [idAp, idGr])
  agencia   Agencia   @relation(fields: [idAg], references: [id])
  solicitud Solicitud @relation(fields: [idSolicitud], references: [id])

  @@id([idAp, idGr, idAg, idSolicitud])
  @@map("ArtistaSolicitaGrupo")
}

